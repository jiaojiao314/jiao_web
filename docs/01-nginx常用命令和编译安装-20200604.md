# 1 常用命令

```
nginx -s quit         优雅停止nginx，有连接时会等连接请求完成再杀死worker进程  
nginx -s reload     优雅重启，并重新载入配置文件nginx.conf
nginx -s reopen     重新打开日志文件，一般用于切割日志
nginx -v            查看版本  
nginx -t            检查nginx的配置文件
nginx -h            查看帮助信息
nginx -V       详细版本信息，包括编译参数 
nginx  -c filename  指定配置文件
```



# 2 编译安装



## 2.1 nginx编译环境准备



准备编译安装的基础环境：



```
[root@s2 ~]# yum install -y vim lrzsz tree screen psmisc \
lsof tcpdump wget ntpdate gcc gcc-c++ glibc glibc-devel pcre pcre-devel \
openssl openssl-devel systemd-devel net-tools iotop bc zip unzip \
zlib-devel bash-completion nfs-utils automake \
libxml2 libxml2-devel libxslt libxslt-devel perl
```





## 2.2下载源码包

https://nginx.org/en/download.html



```
[root@s2 ~]# cd /opt
[root@s2 src]# tar xf nginx-1.9.9.tar.gz
[root@s2 src]# cd nginx-1.9.9.tar.gz
```





## 2.3编译安装

```
[root@s2 nginx-1.19.9]#./configure --prefix=/opt/nginx/ \
--user=nginx \
--group=nginx \
--with-http_ssl_module \
--with-http_v2_module \
--with-http_realip_module \
--with-http_stub_status_module \
--with-http_gzip_static_module \
--with-pcre \
--with-stream \
--with-stream_ssl_module \
--with-stream_realip_module


[root@s2 nginx-1.19.9]# make    #编译步骤，根据Makefile文件生成相应的模块
[root@s2 nginx-1.19.9]# make    install #创建目录，并将生成的模块和文件复制到相应的目录：
[root@s2 nginx-1.19.9]# useradd nginx -s    /sbin/nologin   -u 2000
[root@s2 nginx-1.19.9]# chown   nginx.nginx -R /apps/nginx/
```

备注：nginx 完成安装以后，有四个主要的目录：

```
conf：保存nginx所有的配置文件，其中nginx.conf是nginx服务器的最核心最主要的配置文件，其他的.conf则是用来配置nginx相关的功能的，例如fastcgi功能使用的是fastcgi.conf和fastcgi_params两个文件，配置文件一般都有个样板配置文件，是文件名.default结尾，使用的使用将其复制为并将default去掉即可。
html目录中保存了nginx服务器的web文件，但是可以更改为其他目录保存web文件,另外还有一个50x的web文件是默认的错误页面提示页面。

logs：用来保存nginx服务器的访问日志错误日志等日志，logs目录可以放在其他路径，比如/var/logs/nginx
里面。

sbin：保存nginx二进制启动脚本，可以接受不同的参数以实现不同的功能。
```



## 2.4 ***\*验证版本及编译参数：\****



```
[root@s2 nginx-1.19.9]# /apps/nginx/sbin/nginx  -V
nginx version: nginx/1.19.9
built by gcc 4.8.5 20150623 (Red Hat 4.8.5-36) (GCC)
built with OpenSSL 1.0.2k-fips  26 Jan 2017
TLS SNI support enabled
configure arguments: --prefix=/apps/nginx --user=nginx --group=nginx --with- http_ssl_module --with-http_v2_module --with-http_realip_module --with- http_stub_status_module --with-http_gzip_static_module --with-pcre --with-stream -- with-stream_ssl_module --with-stream_realip_module
```



## 2.5 ***\*访问编译安装的\*******\*nginx\**** ***\*Web\**** ***\*界面：\**** 

***\*
\****

***\*![image.png](https://cdn.nlark.com/yuque/0/2020/png/671316/1591233292555-c3143449-de79-4cc7-b96e-13c802d3aea4.png)\****

***\*
\****

***\*
\****

*****

## 2.6 创建Nginx自启动脚本：

```
[root@s1 ~]# cat    /usr/lib/systemd/system/nginx.service 

[Unit]
Description=The nginx HTTP and reverse proxy server
After=network.target remote-fs.target nss-lookup.target
[Service] 
Type=forking
PIDFile=/apps/nginx/logs/nginx.pid
# Nginx will fail to start if /run/nginx.pid already exists but has the wrong # SELinux context. This might happen when running `nginx -t` from the cmdline. # https://bugzilla.redhat.com/show_bug.cgi?id=1268621
ExecStartPre=/usr/bin/rm -f /opt/nginx/logs/nginx.pid 
ExecStartPre=/opt/nginx/sbin/nginx -t 
ExecStart=/opt/nginx/sbin/nginx -c /opt/nignx/conf/nginx.conf
ExecReload=/bin/kill -s HUP $MAINPID #KillSignal=SIGQUIT #TimeoutStopSec=5
KillMode=process PrivateTmp=true
 
[Install]
WantedBy=multi-user.target
```







## 2.7 验证Nginx自启动脚本：

```
[root@s2 nginx-1.19.9]# systemctl daemon-reload
[root@s2 nginx-1.19.9]# systemctl   start   nginx
[root@s2 nginx-1.19.9]# systemctl   enable  nginx
Created symlink from /etc/systemd/system/multi-user.target.wants/nginx.service to
/usr/lib/systemd/system/nginx.service.
[root@s2 nginx-1.19.9]# systemctl   status nginx
● nginx.service - The nginx HTTP and reverse proxy server
Loaded: loaded (/usr/lib/systemd/system/nginx.service; enabled; vendor preset: disabled)
Active: active (running) since Mon 2019-02-18 11:11:38 CST; 10s ago Main PID: 6348 (nginx)
CGroup: /system.slice/nginx.service
├─6348 nginx: master process /opt/nginx/sbin/nginx
Feb 18 11:11:38 s2.example.com systemd[1]: Starting The nginx HTTP and reverse proxy server...
Feb 18 11:11:38 s2.example.com nginx[6343]: nginx: the configuration file
/apps/nginx/conf/nginx.conf syntax is ok
Feb 18 11:11:38 s2.example.com nginx[6343]: nginx: configuration file
/apps/nginx/conf/nginx.conf test is successful
Feb 18 11:11:38 s2.example.com systemd[1]: Started The nginx HTTP and reverse proxy server.
```







## 2.8：配置Nginx：

***\*
\****

Nginx的配置文件的组成部分： 主配置文件：nginx.conf，子配置文件 include conf.d/*.conf

```
fastcgi， uwsgi，scgi等协议相关的配置文件
mime.types：支持的mime类型，MIME(Multipurpose Internet Mail Extensions)多用途互联网邮件扩展类型，MIME消息能包含文本、图像、音频、视频以及其他应用程序专用的数据，是设定某种扩展名的文件用一种    应用程序来打开的方式类型，当该扩展名文件被访问的时候，浏览器会自动使用指定应用程序来打开。多用于指定    一些客户端自定义的文件名，以及一些媒体文件打开方式。
主配置文件的配置指令：
directive value [value2 ...];
注意：
(1) 指令必须以分号结尾
(2) 支持使用配置变量
内建变量：由Nginx模块引入，可直接引用
自定义变量：由用户使用set命令定义
set variable_name value;
引用变量：$variable_name
```



## 2.9 把nginx程序加入环境变量

```
echo "PATH=/opt/nginx/sbin/:$PATH" >> /etc/profile.d/nginx.sh
source /etc/profile.d/nginx.sh
nginx -v
```